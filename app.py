import os
from flask import Flask, request, jsonify
from dotenv import load_dotenv

# ุชุญููู ุงููุชุบูุฑุงุช ูู .env (ุฅุฐุง ููุฌูุฏ)
load_dotenv()

# ุงูุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงูุฃุณุงุณูุฉ
OPENAI_API_KEY = os.environ.get("OPENAI_API_KEY")
GENAI_API_KEY = os.environ.get("GENAI_API_KEY")
PORT = int(os.environ.get("PORT", 10000))  # ูุณุชุฎุฏู PORT ูู ุงูุจูุฆุฉ ุฃู 10000 ูุงูุชุฑุงุถู

if not OPENAI_API_KEY or not GENAI_API_KEY:
    raise ValueError("ูุฌุจ ุชุนููู ุฌููุน ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ OPENAI_API_KEY ู GENAI_API_KEY ูู .env ุฃู Render")

app = Flask(__name__)

# --- ูุณุงุนุฏุฉ ุงูุฃูุงูุฑ ---
HELP_TEXT = """
ุฃูุงูุฑ ุงูุจูุช ุงููุชุงุญุฉ:
1๏ธโฃ ุชุนููู ุงูุฅูุฌููุฒูุฉ ุจุทุฑููุฉ ูุนุจุฉ: ุฃุฑุณู "ุชุนููู" + ูุณุชูุงู.
2๏ธโฃ ูุถูุถุฉ ุงููุดุงุนุฑ: ุฃุฑุณู "ูุถูุถุฉ" + ุดุนูุฑู.
3๏ธโฃ ุชูููุฏ ุตูุฑุฉ: ุฃุฑุณู "ุตูุฑุฉ" + ูุตู ุงูุตูุฑุฉ.
4๏ธโฃ ุชูููุฏ ููุฏูู: ุฃุฑุณู "ููุฏูู" + ูุตู ุงูููุฏูู.
5๏ธโฃ ุฅูุดุงุก ุนุฑุถ ุชูุฏููู: ุฃุฑุณู "ุนุฑุถ" + ูุตู ุงูุดุฑุงุฆุญ.
6๏ธโฃ ุฅูุดุงุก ุฃูุงูุฑ AI: ุฃุฑุณู "ุฃูุฑ" + ูุง ุชุฑูุฏ ุชูููุฏู ุฃู ูุชุงุจุชู.
7๏ธโฃ ุญู ูุงุฌุจุงุช: ุฃุฑุณู "ูุงุฌุจ" + ุงูููุถูุน + ุงูุตู + ุงูุตูุญุฉ.
8๏ธโฃ ูุณุงุนุฏุฉ: ุฃุฑุณู "ูุณุงุนุฏุฉ" ููุญุตูู ุนูู ูุฐู ุงููุงุฆูุฉ.
"""

# --- ููุทุฉ ุฏุฎูู ููุจูุช ---
@app.route("/bot", methods=["POST"])
def bot():
    data = request.json
    user_message = data.get("message", "").strip()
    response = ""

    if not user_message:
        return jsonify({"response": "ูุฑุฌู ุฅุฑุณุงู ุฑุณุงูุฉ ุตุญูุญุฉ."})

    # ูุณุงุนุฏุฉ
    if user_message.lower() == "ูุณุงุนุฏุฉ":
        response = HELP_TEXT

    # ูุซุงู: ุชูููุฏ ุตูุฑุฉ
    elif user_message.startswith("ุตูุฑุฉ "):
        prompt = user_message.replace("ุตูุฑุฉ ", "")
        # ููุง ูููู ุฏูุฌ ูููุฏ ุงูุตูุฑ (OpenAI ุฃู ุฃู API)
        response = f"โ ุชู ุฅูุดุงุก ุฃูุฑ ุชูููุฏ ุตูุฑุฉ ุจุงููุตู: {prompt}"

    # ูุซุงู: ุชูููุฏ ููุฏูู
    elif user_message.startswith("ููุฏูู "):
        prompt = user_message.replace("ููุฏูู ", "")
        response = f"โ ุชู ุฅูุดุงุก ุฃูุฑ ุชูููุฏ ููุฏูู ุจุงููุตู: {prompt}"

    # ูุซุงู: ุฅูุดุงุก ุนุฑุถ ุชูุฏููู
    elif user_message.startswith("ุนุฑุถ "):
        prompt = user_message.replace("ุนุฑุถ ", "")
        response = f"โ ุชู ุฅูุดุงุก ุฃูุฑ ุนุฑุถ ุชูุฏููู ุจุงููุตู: {prompt}"

    # ูุซุงู: ุฅูุดุงุก ุฃูุฑ AI
    elif user_message.startswith("ุฃูุฑ "):
        prompt = user_message.replace("ุฃูุฑ ", "")
        response = f"โ ุชู ุฅูุดุงุก ุฃูุฑ ุงุญุชุฑุงูู ูู AI: {prompt}"

    # ูุถูุถุฉ ุงููุดุงุนุฑ
    elif user_message.startswith("ูุถูุถุฉ "):
        feeling = user_message.replace("ูุถูุถุฉ ", "")
        response = f"๐ค ูููุช ุดุนูุฑู '{feeling}'ุ ุฅููู ูุตูุญุฉ: ุญุงูู ุงูุชุนุจูุฑ ุนูู ุจุงููุชุงุจุฉ ุฃู ุงูุชุญุฏุซ ูุน ุดุฎุต ุชุซู ุจู."

    # ุชุนููู ุงูุฅูุฌููุฒูุฉ ุจุทุฑููุฉ ูุนุจุฉ
    elif user_message.startswith("ุชุนููู "):
        level = user_message.replace("ุชุนููู ", "")
        response = f"๐ฎ ุชุนููู ุงูุฅูุฌููุฒูุฉ ุจุทุฑููุฉ ูุนุจุฉ ูููุณุชูู '{level}'. ูุซุงู: ุงุฎุชุฑ ุงูุญุฑูู ุงูุตุญูุญุฉ ูุชูููู ูููุงุช!"

    # ุญู ูุงุฌุจุงุช
    elif user_message.startswith("ูุงุฌุจ "):
        details = user_message.replace("ูุงุฌุจ ", "")
        response = f"๐ ุชู ุงูุจุญุซ ุนู ุญููู ุงููุงุฌุจ: {details} (ุณุชุธูุฑ ูู ููุฎุตุงุช ูุฃุฌูุจุฉ ูู ุงููุตุงุฏุฑ ุงููุชุงุญุฉ)"

    else:
        response = "โ ูู ุฃููู ุฑุณุงูุชู. ุฃุฑุณู 'ูุณุงุนุฏุฉ' ููุญุตูู ุนูู ูุงุฆูุฉ ุงูุฃูุงูุฑ."

    return jsonify({"response": response})


# --- ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ---
@app.route("/", methods=["GET"])
def home():
    return "โ ุงูุจูุช ุฌุงูุฒ ููุนูู!"

# ุชุดุบูู ุงูุชุทุจูู
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=PORT)
